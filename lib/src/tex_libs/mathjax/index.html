<!DOCTYPE html>
<html>
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<head>
    <style>
        .MathJax_SVG:focus {
            outline: none;
        }

    </style>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .tex-view-child {

            overflow: hidden;
            position: relative;
        }

        .tex-view-child .ripple {
            border-radius: 50%;
            background-color: lightgrey;
            position: absolute;
            transform: scale(0);
            animation: ripple 0.6s linear;
        }

        @keyframes ripple {
            to {
                transform: scale(2.5);
                opacity: 0;
            }
        }

    </style>
    <script id="MathJaxConfig" type="text/x-mathjax-config">
        MathJax.Hub.Config({
        showMathMenu:false,
        delayStartupUntil: "configured",
        tex2jax: {
          ignoreClass: "tex2jax_ignore",
        },

          jax: ["input/TeX", "output/SVG"],
          extensions: ["tex2jax.js", "MathEvents.js"],
          TeX: {
              extensions: ["mhchem.js","noErrors.js", "noUndefined.js", "autoload-all.js"],
              noErrors: { disabled: true }

          },
          MathMenu: {
              showRenderer: false
          },
          messageStyle: "none",
          SVG: {
              blacker: 0,
              font: "Gyre-Pagella",
              linebreaks: {
                  automatic: true,
                  width: "container"
              },
              scale: 90,
              useFontCache: true,
              useGlobalCache: true,
              matchFontHeight: true

          },
      });














    </script>
    <script src="MathJax.js" type="text/javascript"></script>
</head>

<body>


<div id="TeXView"></div>
<script>
    function initTeXView() {
        const teXView = document.getElementById('TeXView');
        const theUrl = "http://localhost:5353/getRawTeXHTML";
        const http = new XMLHttpRequest()
        http.open("GET", theUrl)
        http.send()
        http.onload = () => {
            let rawTeXHTML = JSON.parse(http.responseText);
            teXView.setAttribute("style", rawTeXHTML['style']);
            rawTeXHTML['children'].forEach((child) => {
                let teXViewChild = document.createElement('div');
                teXViewChild.setAttribute("style", child['decoration']['style']);
                teXViewChild.classList.add("tex-view-child");
                let teXViewChildTitle = document.createElement('div');
                teXViewChildTitle.setAttribute("style", child['decoration']['titleStyle']);
                teXViewChildTitle.innerHTML = child['title'];
                teXViewChild.appendChild(teXViewChildTitle)
                let teXViewChildBody = document.createElement('div');
                teXViewChildBody.setAttribute("style", child['decoration']['bodyStyle']);
                teXViewChildBody.innerHTML = child['body'];
                teXViewChild.appendChild(teXViewChildBody)
                let childID = child['id'];
                if (childID != null) {
                    teXViewChild.addEventListener('click', function (e) {
                        TeXViewItemTapCallback.postMessage(childID);
                        let ripple = document.createElement('div');
                        this.appendChild(ripple);
                        let d = Math.max(this.clientWidth, this.clientHeight);
                        ripple.style.width = ripple.style.height = d + 'px';
                        let rect = this.getBoundingClientRect();
                        ripple.style.left = e.clientX - rect.left - d / 2 + 'px';
                        ripple.style.top = e.clientY - rect.top - d / 2 + 'px';
                        ripple.classList.add('ripple');
                    });
                }
                teXView.appendChild(teXViewChild)
            });

            MathJax.Hub.Queue(["Typeset", MathJax.Hub, "TeXView"], function () {
                RenderedTeXViewHeight.postMessage(document.body.scrollHeight);
            });
        }

    }

    initTeXView();

</script>

</body>
</html>