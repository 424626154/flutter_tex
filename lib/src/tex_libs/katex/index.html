<!DOCTYPE html>
<html lang="">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<head>
    <style>
        .katex-display > .katex {
            display: inline-block;
            white-space: nowrap;
            max-width: 100%;
            overflow-x: scroll;
            text-align: initial;
        }

        .katex {
            font: normal 1.21em KaTeX_Main, Times New Roman, serif;
            line-height: 1.2;
            white-space: normal;
            text-indent: 0;
        }

    </style>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .tex-view-child {
            overflow: hidden;
            position: relative;
        }

        .tex-view-child .ripple {
            border-radius: 50%;
            background-color: lightgrey;
            position: absolute;
            transform: scale(0);
            animation: ripple 0.6s linear;
        }

        @keyframes ripple {
            to {
                transform: scale(2.5);
                opacity: 0;
            }
        }
    </style>

    <link crossorigin="anonymous" href="katex.css" rel="stylesheet">
    <script crossorigin="anonymous" src="katex.js"></script>
    <script crossorigin="anonymous" src="contrib/auto-render.js"></script>
    <script crossorigin="anonymous" src="contrib/mhchem.js"></script>

</head>


<body>
<div id="TeXView"></div>
<script>
    const teXViewServerPort = decodeURIComponent(new URLSearchParams(window.location.search).get('teXViewServerPort'));
    const teXView = document.getElementById('TeXView');

    initTeXView();

    function initTeXView() {
        const requestUrl = `http://localhost:${teXViewServerPort}/?query=getRawTeXHTML`;
        const httpRequest = new XMLHttpRequest();
        httpRequest.open('GET', requestUrl);
        httpRequest.send();
        httpRequest.onload = () => {
            let rawTeXHTML = JSON.parse(httpRequest.responseText);
            teXView.setAttribute('style', rawTeXHTML['style']);
            rawTeXHTML['children'].forEach((child) => {
                let teXViewChild = document.createElement('div');
                teXViewChild.setAttribute("style", child['decoration']['style']);
                teXViewChild.classList.add("tex-view-child");
                let teXViewChildTitle = document.createElement('div');
                teXViewChildTitle.setAttribute("style", child['decoration']['titleStyle']);
                teXViewChildTitle.innerHTML = child['title'];
                teXViewChild.appendChild(teXViewChildTitle)
                let teXViewChildBody = document.createElement('div');
                teXViewChildBody.setAttribute('style', child['decoration']['bodyStyle']);
                teXViewChildBody.innerHTML = child['body'];
                teXViewChild.appendChild(teXViewChildBody)
                let childID = child['id'];
                if (childID != null) {
                    teXViewChild.addEventListener('click', function (e) {
                        TeXViewChildTapCallback.postMessage(childID);
                        let ripple = document.createElement('div');
                        this.appendChild(ripple);
                        let d = Math.max(this.clientWidth, this.clientHeight);
                        ripple.style.width = ripple.style.height = d + 'px';
                        let rect = this.getBoundingClientRect();
                        ripple.style.left = e.clientX - rect.left - d / 2 + 'px';
                        ripple.style.top = e.clientY - rect.top - d / 2 + 'px';
                        ripple.classList.add('ripple');
                    });
                }
                teXView.appendChild(teXViewChild)
            });

            onRenderComplete();
        }
    }
</script>
<script>
    function onRenderComplete() {
        renderMathInElement(teXView);
        setTimeout(() => {
            RenderedTeXViewHeight.postMessage(document.body.scrollHeight);
        }, 0)
    }
</script>
</body>
</html>